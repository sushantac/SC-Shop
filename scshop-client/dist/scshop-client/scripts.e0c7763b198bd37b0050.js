!function(K,L){if("object"==typeof exports)"object"==typeof module?module.exports=L(require("js-sha256"),require("base64-js")):exports.keycloak=L(require("js-sha256"),require("base64-js"));else{!function(){function p(e,t){t?(r[0]=r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0,this.blocks=r):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function w(e,t,r){var n;if("string"==(n=typeof e)){var o,i=[],s=e.length,a=0;for(n=0;n<s;++n)128>(o=e.charCodeAt(n))?i[a++]=o:2048>o?(i[a++]=192|o>>6,i[a++]=128|63&o):55296>o||57344<=o?(i[a++]=224|o>>12,i[a++]=128|o>>6&63,i[a++]=128|63&o):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++n)),i[a++]=240|o>>18,i[a++]=128|o>>12&63,i[a++]=128|o>>6&63,i[a++]=128|63&o);e=i}else{if("object"!==n)throw Error(k);if(null===e)throw Error(k);if(D&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||D&&ArrayBuffer.isView(e)))throw Error(k)}for(64<e.length&&(e=new p(t,!0).update(e).array()),o=[],i=[],n=0;64>n;++n)o[n]=92^(s=e[n]||0),i[n]=54^s;p.call(this,t,r),this.update(i),this.oKeyPad=o,this.inner=!0,this.sharedMemory=r}var k="input is invalid type",u="object"==typeof window,n=u?window:{};n.JS_SHA256_NO_WINDOW&&(u=!1);var u=!u&&"object"==typeof self,y=!n.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;y?n=global:u&&(n=self);var u=!n.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,q="function"==typeof define&&define.amd,D=!n.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,a="0123456789abcdef".split(""),g=[-2147483648,8388608,32768,128],d=[24,16,8,0],c=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=["hex","array","digest","arrayBuffer"],r=[];!n.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!D||!n.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var m=function(e,t){return function(r){return new p(t,!0).update(r)[e]()}},I=function(e){var t=m("hex",e);y&&(t=Q(t,e)),t.create=function(){return new p(e)},t.update=function(e){return t.create().update(e)};for(var r=0;r<f.length;++r){var n=f[r];t[n]=m(n,e)}return t},Q=function(b,a){var d=eval("require('crypto')"),c=eval("require('buffer').Buffer"),e=a?"sha224":"sha256";return function(t){if("string"==typeof t)return d.createHash(e).update(t,"utf8").digest("hex");if(null==t)throw Error(k);return t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),Array.isArray(t)||ArrayBuffer.isView(t)||t.constructor===c?d.createHash(e).update(new c(t)).digest("hex"):b(t)}},F=function(e,t){return function(r,n){return new w(r,t,!0).update(n)[e]()}},J=function(e){var t=F("hex",e);t.create=function(t){return new w(t,e)},t.update=function(e,r){return t.create(e).update(r)};for(var r=0;r<f.length;++r){var n=f[r];t[n]=F(n,e)}return t};p.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"!==r)throw Error(k);if(null===e)throw Error(k);if(D&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||D&&ArrayBuffer.isView(e)))throw Error(k);t=!0}for(var n,o=0,i=e.length,s=this.blocks;o<i;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(r=this.start;o<i&&64>r;++o)s[r>>2]|=e[o]<<d[3&r++];else for(r=this.start;o<i&&64>r;++o)128>(n=e.charCodeAt(o))?s[r>>2]|=n<<d[3&r++]:2048>n?(s[r>>2]|=(192|n>>6)<<d[3&r++],s[r>>2]|=(128|63&n)<<d[3&r++]):55296>n||57344<=n?(s[r>>2]|=(224|n>>12)<<d[3&r++],s[r>>2]|=(128|n>>6&63)<<d[3&r++],s[r>>2]|=(128|63&n)<<d[3&r++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++o)),s[r>>2]|=(240|n>>18)<<d[3&r++],s[r>>2]|=(128|n>>12&63)<<d[3&r++],s[r>>2]|=(128|n>>6&63)<<d[3&r++],s[r>>2]|=(128|63&n)<<d[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,64<=r?(this.block=s[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes%=4294967296),this}},p.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=g[3&t],this.block=e[16],56<=t&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},p.prototype.hash=function(){var e,t,r,n,o,i,s,a=this.h0,u=this.h1,d=this.h2,f=this.h3,l=this.h4,h=this.h5,p=this.h6,m=this.h7,v=this.blocks;for(e=16;64>e;++e)t=((o=v[e-15])>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,r=((o=v[e-2])>>>17|o<<15)^(o>>>19|o<<13)^o>>>10,v[e]=v[e-16]+t+v[e-7]+r<<0;for(s=u&d,e=0;64>e;e+=4)this.first?(this.is224?(i=300032,m=(o=v[0]-1413257819)-150054599<<0,f=o+24177077<<0):(i=704751109,m=(o=v[0]-210244248)-1521486534<<0,f=o+143694565<<0),this.first=!1):(n=(i=a&u)^a&d^s,m=f+(o=m+((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&h^~l&p)+c[e]+v[e])<<0,f=o+((t=(a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+n)<<0),n=(s=f&a)^f&u^i,p=d+(o=p+((m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&l^~m&h)+c[e+1]+v[e+1])<<0,t=((d=o+((t=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10))+n)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),n=(r=d&f)^d&a^s,h=u+(o=h+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&m^~p&l)+c[e+2]+v[e+2])<<0,t=((u=o+(t+n)<<0)>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),n=(s=u&d)^u&f^r,l=a+(o=l+((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&p^~h&m)+c[e+3]+v[e+3])<<0,a=o+(t+n)<<0;this.h0=this.h0+a<<0,this.h1=this.h1+u<<0,this.h2=this.h2+d<<0,this.h3=this.h3+f<<0,this.h4=this.h4+l<<0,this.h5=this.h5+h<<0,this.h6=this.h6+p<<0,this.h7=this.h7+m<<0},p.prototype.hex=function(){this.finalize();var e=this.h1,t=this.h2,r=this.h3,n=this.h4,o=this.h5,i=this.h6,s=this.h7,c=a[(c=this.h0)>>28&15]+a[c>>24&15]+a[c>>20&15]+a[c>>16&15]+a[c>>12&15]+a[c>>8&15]+a[c>>4&15]+a[15&c]+a[e>>28&15]+a[e>>24&15]+a[e>>20&15]+a[e>>16&15]+a[e>>12&15]+a[e>>8&15]+a[e>>4&15]+a[15&e]+a[t>>28&15]+a[t>>24&15]+a[t>>20&15]+a[t>>16&15]+a[t>>12&15]+a[t>>8&15]+a[t>>4&15]+a[15&t]+a[r>>28&15]+a[r>>24&15]+a[r>>20&15]+a[r>>16&15]+a[r>>12&15]+a[r>>8&15]+a[r>>4&15]+a[15&r]+a[n>>28&15]+a[n>>24&15]+a[n>>20&15]+a[n>>16&15]+a[n>>12&15]+a[n>>8&15]+a[n>>4&15]+a[15&n]+a[o>>28&15]+a[o>>24&15]+a[o>>20&15]+a[o>>16&15]+a[o>>12&15]+a[o>>8&15]+a[o>>4&15]+a[15&o]+a[i>>28&15]+a[i>>24&15]+a[i>>20&15]+a[i>>16&15]+a[i>>12&15]+a[i>>8&15]+a[i>>4&15]+a[15&i];return this.is224||(c+=a[s>>28&15]+a[s>>24&15]+a[s>>20&15]+a[s>>16&15]+a[s>>12&15]+a[s>>8&15]+a[s>>4&15]+a[15&s]),c},p.prototype.toString=p.prototype.hex,p.prototype.digest=function(){this.finalize();var e=this.h1,t=this.h2,r=this.h3,n=this.h4,o=this.h5,i=this.h6,s=this.h7,a=[(a=this.h0)>>24&255,a>>16&255,a>>8&255,255&a,e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,o>>24&255,o>>16&255,o>>8&255,255&o,i>>24&255,i>>16&255,i>>8&255,255&i];return this.is224||a.push(s>>24&255,s>>16&255,s>>8&255,255&s),a},p.prototype.array=p.prototype.digest,p.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},w.prototype=new p,w.prototype.finalize=function(){if(p.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();p.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),p.prototype.finalize.call(this)}};var B=I();B.sha256=B,B.sha224=I(!0),B.sha256.hmac=J(),B.sha224.hmac=J(!0),u?module.exports=B:(n.sha256=B.sha256,n.sha224=B.sha224,q&&define((function(){return B})))}(),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).base64js=e()}((function(){return function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);throw(a=Error("Cannot find module '"+s+"'")).code="MODULE_NOT_FOUND",a}a=r[s]={exports:{}},t[s][0].call(a.exports,(function(e){return o(t[s][1][e]||e)}),a,a.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({"/":[function(e,t,r){function n(e){var t=e.length;if(0<t%4)throw Error("Invalid string. Length must be a multiple of 4");return-1===(e=e.indexOf("="))&&(e=t),[e,e===t?0:4-e%4]}function o(e,t,r){for(var n=[],o=t;o<r;o+=3)n.push(i[(t=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]);return n.join("")}r.byteLength=function(e){var t=(e=n(e))[1];return 3*(e[0]+t)/4-t},r.toByteArray=function(e){for(var t,r=n(e),o=new a(3*((t=r[0])+(r=r[1]))/4-r),i=0,c=0<r?t-4:t,u=0;u<c;u+=4)t=s[e.charCodeAt(u)]<<18|s[e.charCodeAt(u+1)]<<12|s[e.charCodeAt(u+2)]<<6|s[e.charCodeAt(u+3)],o[i++]=t>>16&255,o[i++]=t>>8&255,o[i++]=255&t;return 2===r&&(t=s[e.charCodeAt(u)]<<2|s[e.charCodeAt(u+1)]>>4,o[i++]=255&t),1===r&&(t=s[e.charCodeAt(u)]<<10|s[e.charCodeAt(u+1)]<<4|s[e.charCodeAt(u+2)]>>2,o[i++]=t>>8&255,o[i++]=255&t),o},r.fromByteArray=function(e){for(var t=e.length,r=t%3,n=[],s=0,a=t-r;s<a;s+=16383)n.push(o(e,s,s+16383>a?a:s+16383));return 1===r?n.push(i[(e=e[t-1])>>2]+i[e<<4&63]+"=="):2===r&&n.push(i[(e=(e[t-2]<<8)+e[t-1])>>10]+i[e>>4&63]+i[e<<2&63]+"="),n.join("")};var i=[],s=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array;for(e=0;64>e;++e)i[e]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e],s["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;s[45]=62,s[95]=63},{}]},{},[])("/")})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,(function(){function e(e){var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){return t.reject(r)}))}))}function t(){}function r(e){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(e,this)}function n(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,r._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(s){return void i(t.promise,s)}o(t.promise,n)}else(1===e._state?o:i)(t.promise,e._value)}))):e._deferreds.push(t)}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof r)return e._state=3,e._value=t,void s(e);if("function"==typeof n)return void a(function(e,t){return function(){e.apply(t,arguments)}}(n,t),e)}e._state=1,e._value=t,s(e)}catch(o){i(e,o)}}function i(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&r._immediateFn((function(){e._handled||r._unhandledRejectionFn(e._value)}));for(var t=0,o=e._deferreds.length;o>t;t++)n(e,e._deferreds[t]);e._deferreds=null}function a(e,t){var r=!1;try{e((function(e){r||(r=!0,o(t,e))}),(function(e){r||(r=!0,i(t,e))}))}catch(n){r||(r=!0,i(t,n))}}var c=setTimeout;r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,r){var o=new this.constructor(t);return n(this,new function(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}(e,r,o)),o},r.prototype.finally=e,r.all=function(e){return new r((function(t,r){function n(e,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,(function(t){n(e,t)}),r)}o[e]=s,0==--i&&t(o)}catch(c){r(c)}}if(!e||void 0===e.length)return r(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return t([]);for(var i=o.length,s=0;o.length>s;s++)n(s,o[s])}))},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r((function(t){t(e)}))},r.reject=function(e){return new r((function(t,r){r(e)}))},r.race=function(e){return new r((function(t,n){if(!e||void 0===e.length)return n(new TypeError("Promise.race accepts an array"));for(var o=0,i=e.length;i>o;o++)r.resolve(e[o]).then(t,n)}))},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},r._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var u=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in u?u.Promise.prototype.finally||(u.Promise.prototype.finally=e):u.Promise=r}));var E=L(K.sha256,K.base64js);K.Keycloak=E,"function"==typeof define&&define.amd&&define("keycloak",[],(function(){return E}))}}(window,(function(e,t){function r(){i||(i=!0,console.warn("[KEYCLOAK] Usage of legacy style promise methods such as `.error()` and `.success()` has been deprecated and support will be removed in future versions. Use standard style promise methods such as `.then() and `.catch()` instead."))}function n(e){return e.__proto__=o.prototype,e}function o(e){return n(new Promise(e))}if("undefined"==typeof Promise)throw Error("Keycloak requires an environment that supports Promises. Make sure that you include the appropriate polyfill.");var i=!1;return(o.prototype=Object.create(Promise.prototype)).constructor=o,o.prototype.success=function(e){return r(),n(this.then((function(t){e(t)})))},o.prototype.error=function(e){return r(),n(this.catch((function(t){e(t)})))},function r(n){function i(e,t){var r;if((n=window.crypto||window.msCrypto)&&n.getRandomValues&&window.Uint8Array)r=new Uint8Array(e),n.getRandomValues(r);else for(r=Array(e),n=0;n<r.length;n++)r[n]=Math.floor(256*Math.random());for(var n=Array(e),o=0;o<e;o++)n[o]=t.charCodeAt(r[o]%t.length);return String.fromCharCode.apply(null,n)}function s(){if(void 0!==b.authServerUrl)return"/"==b.authServerUrl.charAt(b.authServerUrl.length-1)?b.authServerUrl+"realms/"+encodeURIComponent(b.realm):b.authServerUrl+"/realms/"+encodeURIComponent(b.realm)}function a(e,t){function r(r,n,o,i){c(r,n,o,s=(s+(new Date).getTime())/2),E&&(b.tokenParsed&&b.tokenParsed.nonce!=e.storedNonce||b.refreshTokenParsed&&b.refreshTokenParsed.nonce!=e.storedNonce||b.idTokenParsed&&b.idTokenParsed.nonce!=e.storedNonce)?(I("[KEYCLOAK] Invalid nonce, clearing token"),b.clearToken(),t&&t.setError()):i&&(b.onAuthSuccess&&b.onAuthSuccess(),t&&t.setSuccess())}var n=e.code,o=e.error,i=e.prompt,s=(new Date).getTime();if(o)"none"!=i?(n={error:o,error_description:e.error_description},b.onAuthError&&b.onAuthError(n),t&&t.setError(n)):t&&t.setSuccess();else if("standard"!=b.flow&&(e.access_token||e.id_token)&&r(e.access_token,null,e.id_token,!0),"implicit"!=b.flow&&n){n="code="+n+"&grant_type=authorization_code",o=b.endpoints.token();var a=new XMLHttpRequest;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n+="&client_id="+encodeURIComponent(b.clientId),n+="&redirect_uri="+e.redirectUri,e.pkceCodeVerifier&&(n+="&code_verifier="+e.pkceCodeVerifier),a.withCredentials=!0,a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){var e=JSON.parse(a.responseText);r(e.access_token,e.refresh_token,e.id_token,"standard"===b.flow),m()}else b.onAuthError&&b.onAuthError(),t&&t.setError()},a.send(n)}}function c(e,t,r,n){b.tokenTimeoutHandle&&(clearTimeout(b.tokenTimeoutHandle),b.tokenTimeoutHandle=null),t?(b.refreshToken=t,b.refreshTokenParsed=u(t)):(delete b.refreshToken,delete b.refreshTokenParsed),r?(b.idToken=r,b.idTokenParsed=u(r)):(delete b.idToken,delete b.idTokenParsed),e?(b.token=e,b.tokenParsed=u(e),b.sessionId=b.tokenParsed.session_state,b.authenticated=!0,b.subject=b.tokenParsed.sub,b.realmAccess=b.tokenParsed.realm_access,b.resourceAccess=b.tokenParsed.resource_access,n&&(b.timeSkew=Math.floor(n/1e3)-b.tokenParsed.iat),null!=b.timeSkew&&(I("[KEYCLOAK] Estimated time difference between browser and server is "+b.timeSkew+" seconds"),b.onTokenExpired)&&(e=1e3*(b.tokenParsed.exp-(new Date).getTime()/1e3+b.timeSkew),I("[KEYCLOAK] Token expires in "+Math.round(e/1e3)+" s"),0>=e?b.onTokenExpired():b.tokenTimeoutHandle=setTimeout(b.onTokenExpired,e))):(delete b.token,delete b.tokenParsed,delete b.subject,delete b.realmAccess,delete b.resourceAccess,b.authenticated=!1)}function u(e){switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),JSON.parse(e)}function d(){var e=i(36,"0123456789abcdef").split("");return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function f(e){e:{var t;switch(b.flow){case"standard":t=["code","state","session_state"];break;case"implicit":t="access_token token_type id_token state session_state expires_in".split(" ");break;case"hybrid":t=["access_token","id_token","code","state","session_state"]}t.push("error"),t.push("error_description"),t.push("error_uri");var r,n,o=e.indexOf("?"),i=e.indexOf("#");if("query"===b.responseMode&&-1!==o?(r=e.substring(0,o),""!==(n=l(e.substring(o+1,-1!==i?i:e.length),t)).paramsString&&(r+="?"+n.paramsString),-1!==i&&(r+=e.substring(i))):"fragment"===b.responseMode&&-1!==i&&(r=e.substring(0,i),""!==(n=l(e.substring(i+1),t)).paramsString&&(r+="#"+n.paramsString)),n&&n.oauthParams)if("standard"===b.flow||"hybrid"===b.flow){if((n.oauthParams.code||n.oauthParams.error)&&n.oauthParams.state){n.oauthParams.newUrl=r,e=n.oauthParams;break e}}else if("implicit"===b.flow&&(n.oauthParams.access_token||n.oauthParams.error)&&n.oauthParams.state){n.oauthParams.newUrl=r,e=n.oauthParams;break e}e=void 0}if(e)return(t=w.get(e.state))&&(e.valid=!0,e.redirectUri=t.redirectUri,e.storedNonce=t.nonce,e.prompt=t.prompt,e.pkceCodeVerifier=t.pkceCodeVerifier),e}function l(e,t){e=e.split("&");for(var r={paramsString:"",oauthParams:{}},n=0;n<e.length;n++){var o=e[n].indexOf("="),i=e[n].slice(0,o);-1!==t.indexOf(i)?r.oauthParams[i]=e[n].slice(o+1):(""!==r.paramsString&&(r.paramsString+="&"),r.paramsString+=e[n])}return r}function h(){var e={setSuccess:function(t){e.resolve(t)},setError:function(t){e.reject(t)}};return e.promise=new o((function(t,r){e.resolve=t,e.reject=r})),e}function p(){var e=h();if(!A.enable||A.iframe)return e.setSuccess(),e.promise;var t=document.createElement("iframe");A.iframe=t,t.onload=function(){var t=b.endpoints.authorize();"/"===t.charAt(0)?(t=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),A.iframeOrigin=t):A.iframeOrigin=t.substring(0,t.indexOf("/",8)),e.setSuccess()};var r=b.endpoints.checkSessionIframe();return t.setAttribute("src",r),t.setAttribute("title","keycloak-session-iframe"),t.style.display="none",document.body.appendChild(t),window.addEventListener("message",(function(e){if(e.origin===A.iframeOrigin&&A.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&b.clearToken();for(var t=A.callbackList.splice(0,A.callbackList.length),r=t.length-1;0<=r;--r){var n=t[r];"error"==e.data?n.setError():n.setSuccess("unchanged"==e.data)}}}),!1),e.promise}function m(){A.enable&&b.token&&setTimeout((function(){v().then((function(e){e&&m()}))}),1e3*A.interval)}function v(){var e=h();if(A.iframe&&A.iframeOrigin){var t=b.clientId+" "+(b.sessionId?b.sessionId:"");A.callbackList.push(e),1==A.callbackList.length&&A.iframe.contentWindow.postMessage(t,A.iframeOrigin)}else e.setSuccess();return e.promise}function y(e){if(!e||"default"==e)return{login:function(e){return window.location.replace(b.createLoginUrl(e)),h().promise},logout:function(e){return window.location.replace(b.createLogoutUrl(e)),h().promise},register:function(e){return window.location.replace(b.createRegisterUrl(e)),h().promise},accountManagement:function(){var e=b.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";return window.location.href=e,h().promise},redirectUri:function(e,t){return 1==arguments.length&&(t=!0),e&&e.redirectUri?e.redirectUri:b.redirectUri?b.redirectUri:location.href}};if("cordova"==e){A.enable=!1;var t=function(e,t,r){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(e,t,r):window.open(e,t,r)},r=function(e){var t=function(e){return e&&e.cordovaOptions?Object.keys(e.cordovaOptions).reduce((function(t,r){return t[r]=e.cordovaOptions[r],t}),{}):{}}(e);return t.location="no",e&&"none"==e.prompt&&(t.hidden="yes"),function(e){return Object.keys(e).reduce((function(t,r){return t.push(r+"="+e[r]),t}),[]).join(",")}(t)};return{login:function(e){var n=h(),o=r(e);e=b.createLoginUrl(e);var i=t(e,"_blank",o),s=!1,c=!1;return i.addEventListener("loadstart",(function(e){0==e.url.indexOf("http://localhost")&&(a(e=f(e.url),n),c=!0,i.close(),s=!0)})),i.addEventListener("loaderror",(function(e){s||(0==e.url.indexOf("http://localhost")?(a(e=f(e.url),n),c=!0,i.close(),s=!0):(n.setError(),c=!0,i.close()))})),i.addEventListener("exit",(function(e){c||n.setError({reason:"closed_by_user"})})),n.promise},logout:function(e){var r=h();e=b.createLogoutUrl(e);var n,o=t(e,"_blank","location=no,hidden=yes");return o.addEventListener("loadstart",(function(e){0==e.url.indexOf("http://localhost")&&o.close()})),o.addEventListener("loaderror",(function(e){0!=e.url.indexOf("http://localhost")&&(n=!0),o.close()})),o.addEventListener("exit",(function(e){n?r.setError():(b.clearToken(),r.setSuccess())})),r.promise},register:function(e){var n=h(),o=b.createRegisterUrl();e=r(e);var i=t(o,"_blank",e);return i.addEventListener("loadstart",(function(e){0==e.url.indexOf("http://localhost")&&(i.close(),a(e=f(e.url),n))})),n.promise},accountManagement:function(){var e=b.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";var r=t(e,"_blank","location=no");r.addEventListener("loadstart",(function(e){0==e.url.indexOf("http://localhost")&&r.close()}))},redirectUri:function(e){return"http://localhost"}}}if("cordova-native"==e)return A.enable=!1,{login:function(e){var t=h();return e=b.createLoginUrl(e),universalLinks.subscribe("keycloak",(function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),a(e=f(e.url),t)})),window.cordova.plugins.browsertab.openUrl(e),t.promise},logout:function(e){var t=h();return e=b.createLogoutUrl(e),universalLinks.subscribe("keycloak",(function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),b.clearToken(),t.setSuccess()})),window.cordova.plugins.browsertab.openUrl(e),t.promise},register:function(e){var t=h();return e=b.createRegisterUrl(e),universalLinks.subscribe("keycloak",(function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),a(e=f(e.url),t)})),window.cordova.plugins.browsertab.openUrl(e),t.promise},accountManagement:function(){var e=b.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";window.cordova.plugins.browsertab.openUrl(e)},redirectUri:function(e){return e&&e.redirectUri?e.redirectUri:b.redirectUri?b.redirectUri:"http://localhost"}};throw"invalid adapter type: "+e}function g(e){return function(){b.enableLogging&&e.apply(console,Array.prototype.slice.call(arguments))}}if(!(this instanceof r))return new r(n);for(var k,w,b=this,_=[],A={enable:!0,callbackList:[],interval:5},S=document.getElementsByTagName("script"),U=0;U<S.length;U++)-1===S[U].src.indexOf("keycloak.js")&&-1===S[U].src.indexOf("keycloak.min.js")||-1===S[U].src.indexOf("version=")||(b.iframeVersion=S[U].src.substring(S[U].src.indexOf("version=")+8).split("&")[0]);var E=!0,I=g(console.info),T=g(console.warn);b.init=function(e){function t(){var t=function(e){e||(n.prompt="none"),b.login(n).then((function(){i.setSuccess()})).catch((function(){i.setError()}))},r=function(){var e=document.createElement("iframe"),t=b.createLoginUrl({prompt:"none",redirectUri:b.silentCheckSsoRedirectUri});e.setAttribute("src",t),e.setAttribute("title","keycloak-silent-check-sso"),e.style.display="none",document.body.appendChild(e);var r=function(t){t.origin===window.location.origin&&e.contentWindow===t.source&&(a(t=f(t.data),i),document.body.removeChild(e),window.removeEventListener("message",r))};window.addEventListener("message",r)},n={};switch(e.onLoad){case"check-sso":A.enable?p().then((function(){v().then((function(e){e?i.setSuccess():b.silentCheckSsoRedirectUri?r():t(!1)})).catch((function(){i.setError()}))})):b.silentCheckSsoRedirectUri?r():t(!1);break;case"login-required":t(!0);break;default:throw"Invalid value for onLoad"}}b.authenticated=!1;e:{try{w=new O;break e}catch(u){}w=new C}var r=["default","cordova","cordova-native"];if(k=e&&-1<r.indexOf(e.adapter)?y(e.adapter):e&&"object"==typeof e.adapter?e.adapter:window.Cordova||window.cordova?y("cordova"):y(),e){if(void 0!==e.useNonce&&(E=e.useNonce),void 0!==e.checkLoginIframe&&(A.enable=e.checkLoginIframe),e.checkLoginIframeInterval&&(A.interval=e.checkLoginIframeInterval),"login-required"===e.onLoad&&(b.loginRequired=!0),e.responseMode){if("query"!==e.responseMode&&"fragment"!==e.responseMode)throw"Invalid value for responseMode";b.responseMode=e.responseMode}if(e.flow){switch(e.flow){case"standard":b.responseType="code";break;case"implicit":b.responseType="id_token token";break;case"hybrid":b.responseType="code id_token token";break;default:throw"Invalid value for flow"}b.flow=e.flow}if(null!=e.timeSkew&&(b.timeSkew=e.timeSkew),e.redirectUri&&(b.redirectUri=e.redirectUri),e.silentCheckSsoRedirectUri&&(b.silentCheckSsoRedirectUri=e.silentCheckSsoRedirectUri),e.pkceMethod){if("S256"!==e.pkceMethod)throw"Invalid value for pkceMethod";b.pkceMethod=e.pkceMethod}b.enableLogging="boolean"==typeof e.enableLogging&&e.enableLogging}b.responseMode||(b.responseMode="fragment"),b.responseType||(b.responseType="code",b.flow="standard");var o=h(),i=h();return i.promise.then((function(){b.onReady&&b.onReady(b.authenticated),o.setSuccess(b.authenticated)})).catch((function(e){o.setError(e)})),(r=function(e){function t(e){b.endpoints=e?{authorize:function(){return e.authorization_endpoint},token:function(){return e.token_endpoint},logout:function(){if(!e.end_session_endpoint)throw"Not supported by the OIDC server";return e.end_session_endpoint},checkSessionIframe:function(){if(!e.check_session_iframe)throw"Not supported by the OIDC server";return e.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!e.userinfo_endpoint)throw"Not supported by the OIDC server";return e.userinfo_endpoint}}:{authorize:function(){return s()+"/protocol/openid-connect/auth"},token:function(){return s()+"/protocol/openid-connect/token"},logout:function(){return s()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){var e=s()+"/protocol/openid-connect/login-status-iframe.html";return b.iframeVersion&&(e=e+"?version="+b.iframeVersion),e},register:function(){return s()+"/protocol/openid-connect/registrations"},userinfo:function(){return s()+"/protocol/openid-connect/userinfo"}}}var r,o=h();if(n?"string"==typeof n&&(r=n):r="keycloak.json",r){var i=new XMLHttpRequest;i.open("GET",r,!0),i.setRequestHeader("Accept","application/json"),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status||0==i.status&&i.responseText&&i.responseURL.startsWith("file:")){var e=JSON.parse(i.responseText);b.authServerUrl=e["auth-server-url"],b.realm=e.realm,b.clientId=e.resource,t(null),o.setSuccess()}else o.setError()},i.send()}else{if(!n.clientId)throw"clientId missing";if(b.clientId=n.clientId,e=n.oidcProvider)"string"==typeof e?(e="/"==e.charAt(e.length-1)?e+".well-known/openid-configuration":e+"/.well-known/openid-configuration",(i=new XMLHttpRequest).open("GET",e,!0),i.setRequestHeader("Accept","application/json"),i.onreadystatechange=function(){4==i.readyState&&(200==i.status||0==i.status&&i.responseText&&i.responseURL.startsWith("file:")?(t(JSON.parse(i.responseText)),o.setSuccess()):o.setError())},i.send()):(t(e),o.setSuccess());else{if(!n.url)for(e=document.getElementsByTagName("script"),r=0;r<e.length;r++)if(e[r].src.match(/.*keycloak\.js/)){n.url=e[r].src.substr(0,e[r].src.indexOf("/js/keycloak.js"));break}if(!n.realm)throw"realm missing";b.authServerUrl=n.url,b.realm=n.realm,t(null),o.setSuccess()}}return o.promise}(n)).then((function(){var r=f(window.location.href);if(r&&window.history.replaceState(window.history.state,null,r.newUrl),r&&r.valid)return p().then((function(){a(r,i)})).catch((function(e){i.setError()}));e?e.token&&e.refreshToken?(c(e.token,e.refreshToken,e.idToken),A.enable?p().then((function(){v().then((function(e){e?(b.onAuthSuccess&&b.onAuthSuccess(),i.setSuccess(),m()):i.setSuccess()})).catch((function(){i.setError()}))})):b.updateToken(-1).then((function(){b.onAuthSuccess&&b.onAuthSuccess(),i.setSuccess()})).catch((function(){b.onAuthError&&b.onAuthError(),e.onLoad?t():i.setError()}))):e.onLoad?t():i.setSuccess():i.setSuccess()})),r.catch((function(){o.setError()})),o.promise},b.login=function(e){return k.login(e)},b.createLoginUrl=function(r){var n,o,s=d(),a=d(),c=k.redirectUri(r),u={state:s,nonce:a,redirectUri:encodeURIComponent(c)};if(r&&r.prompt&&(u.prompt=r.prompt),n=r&&"register"==r.action?b.endpoints.register():b.endpoints.authorize(),o=r&&r.scope?-1!=r.scope.indexOf("openid")?r.scope:"openid "+r.scope:"openid",s=n+"?client_id="+encodeURIComponent(b.clientId)+"&redirect_uri="+encodeURIComponent(c)+"&state="+encodeURIComponent(s)+"&response_mode="+encodeURIComponent(b.responseMode)+"&response_type="+encodeURIComponent(b.responseType)+"&scope="+encodeURIComponent(o),E&&(s=s+"&nonce="+encodeURIComponent(a)),r&&r.prompt&&(s+="&prompt="+encodeURIComponent(r.prompt)),r&&r.maxAge&&(s+="&max_age="+encodeURIComponent(r.maxAge)),r&&r.loginHint&&(s+="&login_hint="+encodeURIComponent(r.loginHint)),r&&r.idpHint&&(s+="&kc_idp_hint="+encodeURIComponent(r.idpHint)),r&&r.locale&&(s+="&ui_locales="+encodeURIComponent(r.locale)),b.pkceMethod){r=i(96,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),u.pkceCodeVerifier=r;e:switch(b.pkceMethod){case"S256":r=new Uint8Array(e.arrayBuffer(r)),r=t.fromByteArray(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");break e;default:throw"Invalid value for pkceMethod"}s=s+"&code_challenge="+r+"&code_challenge_method="+b.pkceMethod}return w.add(u),s},b.logout=function(e){return k.logout(e)},b.createLogoutUrl=function(e){return b.endpoints.logout()+"?redirect_uri="+encodeURIComponent(k.redirectUri(e,!1))},b.register=function(e){return k.register(e)},b.createRegisterUrl=function(e){return e||(e={}),e.action="register",b.createLoginUrl(e)},b.createAccountUrl=function(e){var t=s(),r=void 0;return void 0!==t&&(r=t+"/account?referrer="+encodeURIComponent(b.clientId)+"&referrer_uri="+encodeURIComponent(k.redirectUri(e))),r},b.accountManagement=function(){return k.accountManagement()},b.hasRealmRole=function(e){var t=b.realmAccess;return!!t&&0<=t.roles.indexOf(e)},b.hasResourceRole=function(e,t){return!!b.resourceAccess&&!!(t=b.resourceAccess[t||b.clientId])&&0<=t.roles.indexOf(e)},b.loadUserProfile=function(){var e=s()+"/account",t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+b.token);var r=h();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(b.profile=JSON.parse(t.responseText),r.setSuccess(b.profile)):r.setError())},t.send(),r.promise},b.loadUserInfo=function(){var e=b.endpoints.userinfo(),t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+b.token);var r=h();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(b.userInfo=JSON.parse(t.responseText),r.setSuccess(b.userInfo)):r.setError())},t.send(),r.promise},b.isTokenExpired=function(e){if(!b.tokenParsed||!b.refreshToken&&"implicit"!=b.flow)throw"Not authenticated";if(null==b.timeSkew)return I("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var t=b.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+b.timeSkew;if(e){if(isNaN(e))throw"Invalid minValidity";t-=e}return 0>t},b.updateToken=function(e){var t=h();if(!b.refreshToken)return t.setError(),t.promise;e=e||5;var r=function(){var r=!1;if(-1==e?(r=!0,I("[KEYCLOAK] Refreshing token: forced refresh")):b.tokenParsed&&!b.isTokenExpired(e)||(r=!0,I("[KEYCLOAK] Refreshing token: token expired")),r){r="grant_type=refresh_token&refresh_token="+b.refreshToken;var n=b.endpoints.token();if(_.push(t),1==_.length){var o=new XMLHttpRequest;o.open("POST",n,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.withCredentials=!0,r=r+"&client_id="+encodeURIComponent(b.clientId);var i=(new Date).getTime();o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status){I("[KEYCLOAK] Token refreshed"),i=(i+(new Date).getTime())/2;var e=JSON.parse(o.responseText);for(c(e.access_token,e.refresh_token,e.id_token,i),b.onAuthRefreshSuccess&&b.onAuthRefreshSuccess(),e=_.pop();null!=e;e=_.pop())e.setSuccess(!0)}else for(T("[KEYCLOAK] Failed to refresh token"),400==o.status&&b.clearToken(),b.onAuthRefreshError&&b.onAuthRefreshError(),e=_.pop();null!=e;e=_.pop())e.setError(!0)},o.send(r)}}else t.setSuccess(!1)};return A.enable?v().then((function(){r()})).catch((function(){t.setError()})):r(),t.promise},b.clearToken=function(){b.token&&(c(null,null,null),b.onAuthLogout&&b.onAuthLogout(),b.loginRequired&&b.login())};var O=function(){function e(){for(var e=(new Date).getTime(),t=0;t<localStorage.length;t++){var r=localStorage.key(t);if(r&&0==r.indexOf("kc-callback-")){var n=localStorage.getItem(r);if(n)try{var o=JSON.parse(n).expires;(!o||o<e)&&localStorage.removeItem(r)}catch(i){localStorage.removeItem(r)}}}}if(!(this instanceof O))return new O;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test"),this.get=function(t){if(t){t="kc-callback-"+t;var r=localStorage.getItem(t);return r&&(localStorage.removeItem(t),r=JSON.parse(r)),e(),r}},this.add=function(t){e();var r="kc-callback-"+t.state;t.expires=(new Date).getTime()+36e5,localStorage.setItem(r,JSON.stringify(t))}},C=function(){if(!(this instanceof C))return new C;this.get=function(r){if(r){var n;e:{n="kc-callback-"+r+"=";for(var o=document.cookie.split(";"),i=0;i<o.length;i++){for(var s=o[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(n)){n=s.substring(n.length,s.length);break e}}n=""}if(t("kc-callback-"+r,"",e(-100)),n)return JSON.parse(n)}},this.add=function(r){t("kc-callback-"+r.state,JSON.stringify(r),e(60))},this.removeItem=function(r){t(r,"",e(-100))};var e=function(e){var t=new Date;return t.setTime(t.getTime()+6e4*e),t},t=function(e,t,r){e=e+"="+t+"; expires="+r.toUTCString()+"; ",document.cookie=e}}}}));